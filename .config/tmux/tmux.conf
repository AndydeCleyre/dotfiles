# Hit backtick to prime tmux for an action
set -g prefix `

# Action: backtick: type a literal backtick
bind ` send-prefix

# Set TERM, indicating color support
set -g default-terminal tmux-256color

# set -ga terminal-overrides ',*256col*:Tc:sitm=\E[3m'  # unnecessary?

# Enable mouse usage
set -g mouse on

# setw -g xterm-keys on  # unnecessary?

# Big ol' scrollback
set -g history-limit 300000

# Set WM window title (not the tmux "window," which I herein call a "tab")
set -g set-titles on
set -g set-titles-string "#W - #{USER}@#h.#I"

# Action: enter: toggle status bar
bind enter set -g status

# Status bar as tab bar
set -g status-position top
set -g status-left ''
set -g status-right ''
set -g status-justify right
set -g status-interval 1
setw -g window-status-separator '┆'
set -g status-bg terminal
set -g status-fg colour3
setw -g window-status-style fg='colour4',bg='terminal',italics
setw -g window-status-current-style fg='colour7',bg='terminal',bold
tab_string="\
#{?#{==:#{pane_current_path},$HOME},,\
#{s|^$HOME/||;\
=|-18|…:\
pane_current_path}\
}\
#[bold]\
#{?#{!=:#W,zsh},->#W,\
#{?#{==:#{pane_current_path},$HOME},~,}\
}\
#[nobold]\
#{?#{!=:#{window_panes},1},+,}\
"
setw -g window-status-format "$tab_string"
setw -g window-status-current-format "$tab_string"

# Action: comma: edit "window" title (part of the tab title, usually command name)

# Action: j: left tab
# Action: k: right tab
# Action: l: new tab
bind j prev
bind k next
bind l new-window -c "#{pane_current_path}"

# Action: c OR [: enter copy-mode
# Action: pgup: enter copy-mode, then scroll up
# Action: v OR ]: paste tmux buffer

# Actions within copy-mode only (no prefix for these):
# Action: q: exit copy-mode
# Action: mouse selection: select and save in tmux buffer
# Action: space: start selection
# Action: enter: save selection in tmux buffer, then exit copy-mode
# Action: c: save selection in tmux buffer and clipboard
# Action: h: view tmux buffer with syntax highlighting in new window
# Action: ctrl+{left,right}: jump by word

# TODO: clearly state the effect of vi keys here
setw -g mode-keys vi
bind c copy-mode
bind v paste-buffer
set -g set-clipboard on
bind -T copy-mode-vi c send -X copy-pipe "xclip -sel clip"
bind -T copy-mode-vi h send -X copy-pipe "xclip -sel clip" \; split -c "#{pane_current_path}" \; resize-pane -Z \; send -l "() { zmodload zsh/terminfo; echoti clear; read '?What syntax? '; echoti clear; xclip -sel clip -o | highlight -O truecolor -s base16/bright -t 4 --stdout -S \$REPLY | LESS='RXij.5' less; exit }" \; send Enter
bind -T copy-mode-vi C-Left send-keys -X previous-word
bind -T copy-mode-vi C-Right send-keys -X next-word-end
setw -g mode-style bg="#64004d"

set -g pane-active-border-style fg='colour7'
set -g pane-border-style fg='colour4'

#
# --- Splits ---
#
# Action: s: split pane
# Action: space: rotate through split layouts
# Action: shift+{right,left,down,up}: resize
# Action: mouse drag pane border: resize
bind s split -h -l 45% -c "#{pane_current_path}"
bind -r S-right resize-pane -R 4
bind -r S-down resize-pane -D 4
bind -r S-left resize-pane -L 4
bind -r S-up resize-pane -U 4
# left/right/up/down  walk to pane
# q,<num>             jump to pane
# space               change split layout
# z                   maximize pane
# {/}                 move pane left/right

# TODO: 1, 2, 3: zoomed in, vsplit,
bind 2 split -h -l 45% -c "#{pane_current_path}"

# https://github.com/laktak/extrakto
run-shell ~/Code/plugins/tmux/extrakto/extrakto.tmux
